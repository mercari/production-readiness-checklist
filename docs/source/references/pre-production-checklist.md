<!-- File generated by script/update_prc_docs. DO NOT EDIT. -->

# Pre-production Checklist

This checklist contains points that must be satisfied during implementation and verified prior to release.

Please note that all items in the [design checklist](design-checklist.md) that were verified at the end of the design phase, must still be satisfied at release time (e.g. the design doc must be up-to-date, the SLOs must be consistent, ...).

## :wrench: Maintainability
Maintainability affects team productivity and system availability. If maintainability is low, the team will take a longer time to change the service in production and it will cause longer MTTR (Mean Time To Recover) in case of failures.

| Check name | Short Description  | Level C | Level B | Level A |
| :--------- | :----------------- | :------ | :------ | :------ |
| Unit test | It has unit tests. And the unit tests are running in a CI system. | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| High Test coverage | Its test coverage is over 80%. |  | :white_check_mark: | :white_check_mark: |
| [Config in env-var](https://12factor.net/config) | Its config can be overridden via environment variable.  |  | :white_check_mark: | :white_check_mark: |
| [dockerignore](https://docs.docker.com/engine/reference/builder/#dockerignore-file) | It has dockerignore to reduce the Docker image size. |  | :white_check_mark: | :white_check_mark: |
| [No latest tag](https://twitter.com/thockin/status/1085223284122087424) | Its Docker image tag is not `latest` or `master`. |  | :white_check_mark: | :white_check_mark: |
| [Dependabot](https://dependabot.com/) | Its dependencies are automatically updated. |  | :white_check_mark: | :white_check_mark: |
| [Automated build](../concepts/automated-build.md) | Its build process is automated (binary build and Docker image build is in this scope). | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| [Automatic build](../concepts/automatic-build.md) | Its automated build process is running in CI/CD system. |  |  | :white_check_mark: |
| Automated deploy | Its deploy process is automated. | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| Automatic deploy | Its automated deploy process is running in CI/CD system. |  | :white_check_mark: | :white_check_mark: |
| [Gradual deploy](../concepts/gradual-deploy.md) | Its deploy can be gradual if you want. |  |  | :white_check_mark: |
| [Automated rollback](../concepts/automated-rollback.md) | Its rollback process is automated. |  | :white_check_mark: | :white_check_mark: |

## :chart_with_downwards_trend: Observability
Observability affects team productivity and system availability. If observability is low, the team will take a longer time to notice/investigate a problem occurred in production. And it will make MTTR (Mean Time To Recover) longer.

| Check name | Short Description  | Level C | Level B | Level A |
| :--------- | :----------------- | :------ | :------ | :------ |
| Tracing | Its requests are traced by [Datadog APM](https://docs.datadoghq.com/tracing/). See [Configure Tracing](../guides/configure-tracing.md)| :white_check_mark: | :white_check_mark: | :white_check_mark: |
| Timeboard | Its [Datadog Timeboard](https://docs.datadoghq.com/dashboards/timeboards/) is created. |  | :white_check_mark: | :white_check_mark: |
| Screenboard | Its [Datadog Screenboard](https://docs.datadoghq.com/dashboards/screenboards/) is created. |  |  | :white_check_mark: |
| GCP metrics | Its GCP projects are [integrated with Datadog](https://docs.datadoghq.com/integrations/google_cloud_platform/).  |  | :white_check_mark: | :white_check_mark: |
| Actionable alert | Its Datadog Monitors are created. And those alerts are actionable. | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| Warning alert | Its warning alerts are sent to Slack or a ticket system instead of PagerDuty. |  | :white_check_mark: | :white_check_mark: |
| Critical alert | Its critical alerts are sent to PagerDuty. |  | :white_check_mark: | :white_check_mark: |
| OnCall rotation | It has a PagerDuty team, escalation policy, schedules. |  | :white_check_mark: | :white_check_mark: |
| OnCall playbooks | It has OnCall playbooks. |  |  | :white_check_mark: |
| Log to STDOUT | Its logs are output to STDOUT/STDERR. | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| Log as JSON | Its logs are emitted in [container log format](container-log-format.md). | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| Log with annotation | Its logs have [Request ID](../concepts/request-id.md) annotation | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| Profiling | It is profiled by [GCP Stackdriver Profiler](https://cloud.google.com/profiler). |  | :white_check_mark: | :white_check_mark: |
| Error tracking | Its errors are tracked by Sentry. |  | :white_check_mark: | :white_check_mark: |

## :airplane: Reliability
Reliability affects availability and productivity. If reliability is low, your system will break down often. The team will have to take time to fix it. Then, both system availability and team productivity will be decreased.

| Check name | Short Description  | Level C | Level B | Level A |
| :--------- | :----------------- | :------ | :------ | :------ |
| Manual Scale | It can be manually scaled horizontally to handle changes in workload. | :white_check_mark: |  |  |
| [Auto Scale](../concepts/auto-scaling.md) | It automatically scales horizontally to handle fluctuating workloads, its HPA is set as described in the [Resource Requests and Limits](../concepts/resource-requests-and-limits.md) documentation, and can be scaled manually if needed. |  | :white_check_mark: | :white_check_mark: |
| [CPU req/limit](../concepts/resource-requests-and-limits.md) | Its CPU limit and request are set as described in the [Resource Requests and Limits](../concepts/resource-requests-and-limits.md) documentation. | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| [Memory req/limit](../concepts/resource-requests-and-limits.md) | Its memory resource request value is as same as limit value. | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| [Capacity planning](../concepts/capacity-planning.md) | It can handle the expected load: either load test has been performed, or the expected traffic is under control (e.g., by Gateway). |  | :white_check_mark: | :white_check_mark: |
| [Zero downtime deploy](../concepts/zero-downtime-deploy.md) | Its deploy process does not cause service degradation or downtime (e.g. error rate does not increase during deploy). |  | :white_check_mark: | :white_check_mark: |
| [Graceful shutdown](../concepts/graceful-shutdown.md) | It can stop gracefully. |  | :white_check_mark: | :white_check_mark: |
| [Graceful degradation](../concepts/graceful-degradation.md) | It keeps working, at least partially, while dependencies (e.g. other service or database) are not working partially or completely. |  | :white_check_mark: | :white_check_mark: |
| [PreStop](../concepts/container-lifecycle-hooks-pre-stop.md) | It has a `preStop`. See more on [Configure PreStop](../guides/configure-pre-stop.md). |  | :white_check_mark: | :white_check_mark: |
| [PDB](../concepts/pod-disruption-budget.md) | It has a `PodDisruptionBudget` set as described in the [Configure Pod Distription Budget](../guides/configure-pod-disruption-budget.md) | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| [Liveness Probe](../concepts/liveness-probe.md) | It has a health check (endpoint) for liveness probe. And liveness probe is configured. See more on [Configure Liveness Probe](../guides/configure-liveness-probe.md). | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| [Readiness Probe](../concepts/readiness-probe.md) | It has a health check (endpoint) for readiness probe. And readiness probe is configured. |  | :white_check_mark: | :white_check_mark: |
| Timeout | It sets an appropriate timeout for requests over a network. |  | :white_check_mark: | :white_check_mark: |
| [Smart retry](../concepts/smart-retries.md) | It performs smart retries when interacting with dependencies (e.g. other services or database). |  |  | :white_check_mark: |

## :lock: Security
If security is low, customer and company data will be stolen or fabricated (Data breaches).

| Check name | Short Description  | Level C | Level B | Level A |
| :--------- | :----------------- | :------ | :------ | :------ |
| Security review | It has completed the security design review by security team. |  | :white_check_mark: | :white_check_mark: |
| Non-root user | Its docker container runs as non-root user | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| [Secrets](../concepts/secrets.md) | Its sensitive configuration is stored in Kubernetes secrets.  | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| [Non-sensitive log](../concepts/non-sensitive-log.md ) | It does not write sensitive information to app logs (STDOUT/STDERR). | :white_check_mark: | :white_check_mark: | :white_check_mark: |

## :clipboard: Accessibility
Accessibility affects team/organization productivity. If accessibility is low, getting information about the microservice will be difficult for both people inside/outside the team. It reduces organization productivity.

| Check name | Short Description  | Level C | Level B | Level A |
| :--------- | :----------------- | :------ | :------ | :------ |
| [Design Doc](../concepts/design-doc.md) | Its design doc is up to date with the implementation. | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| Description | It has service description. | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| Contact | It has contact info about the owners. | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| Source repo | It has links to source repo. | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| Docs | It has links to docs for users. | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| SLOs | Its dashboard shows SLOs. | :white_check_mark: | :white_check_mark: | :white_check_mark: |

## :file_folder: Data Storage
 Checks for services that have one or more data stores (e.g. databases, blob storage, ...). In **addition** to these checks, please refer to the service-specific sections below.

| Check name | Short Description  | Level C | Level B | Level A |
| :--------- | :----------------- | :------ | :------ | :------ |
| Data Replication | Its data is replicated to BigQuery (if required). |  | :white_check_mark: | :white_check_mark: |
| Minimal Operator Privileges | Personnel has minimal access privileges and accesses are auditable. |  | :white_check_mark: | :white_check_mark: |
| Recovery | It can be recovered from backup; the procedure has been defined and tested. |  | :white_check_mark: | :white_check_mark: |
| Fast Recovery | It can be recovered from backup in less than 2 hours; the procedure is described in the OnCall playbook, and it is practiced every 6 months. |  |  | :white_check_mark: |
| PIT Recovery | Point-in-time recovery from backup can be completed in less than 2 hours. |  |  | :white_check_mark: |
| Timeboard | Its GCP databases have a Datadog Timeboard. |  | :white_check_mark: | :white_check_mark: |

### GCP Cloud SQL (MySQL)
Checks specific to services using GCP Cloud SQL (MySQL).

| Check name | Short Description  | Level C | Level B | Level A |
| :--------- | :----------------- | :------ | :------ | :------ |
| Maintenance Window | Its databases have a defined [maintenance window](https://cloud.google.com/sql/docs/mysql/instance-settings#maintenance-window-2ndgen) (during core hours). | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| Regional HA | Its databases have [regional HA](https://cloud.google.com/sql/docs/mysql/high-availability) enabled.. |  | :white_check_mark: | :white_check_mark: |
| Read Replicas | Its databases have one or more [read replicas](https://cloud.google.com/sql/docs/mysql/replication), and it uses them for reads that do not need strict consistency. |  |  | :white_check_mark: |
| Missing Master | It keeps correctly serving idempotent requests with no side-effects when the master is unavailable (e.g. by sending all reads to the read replicas and returning internal error to all other requests).. |  |  | :white_check_mark: |
| Failover Tests | It keeps running with minimal disruption during, and fully recovers after, a [database maintenance or failover](https://cloud.google.com/sql/docs/mysql/best-practices#app). |  | :white_check_mark: | :white_check_mark: |
| Operational Guidelines | Its databases are in compliance with the [Cloud SQL Operational guidelines](https://cloud.google.com/sql/docs/mysql/operational-guidelines), so that they do not fall outside the Cloud SQL SLA. | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| [Automatic Backups](../concepts/automatic-backups.md) | Its databases have automatic backups enabled. | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| Automatic Storage Increase | Its databases have [automatic storage increase](https://cloud.google.com/sql/docs/mysql/instance-settings#automatic-storage-increase-2ndgen) enabled. |  | :white_check_mark: | :white_check_mark: |
| Replication Lag | Alerts should be sent if [replication lag](https://cloud.google.com/sql/docs/mysql/high-availability#replication-lag) (`Seconds Behind Master` in Stackdriver) is >300s. |  | :white_check_mark: | :white_check_mark: |
| CPU | CPU usage of each instance (including replicas) should be <50% during peak load, and alerts should be sent if it increases to >80%. | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| Minimal Data Privileges | It has one or more dedicated MySQL users (not `root`) that have only the bare minimum set of required [privileges](https://cloud.google.com/sql/docs/mysql/users#privileges) (e.g. only `SELECT` and `INSERT`, but no `UPDATE`, `DELETE` or any other DDL/admin privileges). If the service has both admin and non-admin endpoints, they should use different users with different permissions. |  | :white_check_mark: | :white_check_mark: |

### GCP Cloud Spanner
Checks specific to services using GCP Cloud Spanner.

| Check name | Short Description  | Level C | Level B | Level A |
| :--------- | :----------------- | :------ | :------ | :------ |
| Regional Configuration | If it is a service deployed in a single region, its databases are in regional configuration and are deployed in the same region. | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| Global Configuration | If it is a service deployed in multiple regions, its databases are in multi-regional configuration and they are deployed in the same regions. |  | :white_check_mark: | :white_check_mark: |
| SLA Exclusions | Its databases are in compliance with the [SLA exclusions](https://cloud.google.com/spanner/sla), so that they do not fall outside of the Cloud Spanner SLA. |  | :white_check_mark: | :white_check_mark: |
| [Automatic Backups](../concepts/automatic-backups.md) | Its databases have scheduled automatic backups. | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| CPU | CPU usage of each node is monitored and alerts are sent if it is >65% (or >45% for multi-regional instances). | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| Disk usage | Disk usage of each node is monitored and alerts are sent if it is >75%. | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| Sessions | Number of sessions on each database+node is monitored and alerts are sent if it is >7500. |  | :white_check_mark: | :white_check_mark: |
